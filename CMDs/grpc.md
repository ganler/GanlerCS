# GRPC

> https://medium.com/@andrewvetovitz/grpc-c-introduction-45a66ca9461f

## Intro

### MicroServices

Different machines/languages need to communicate!

To achieve the goal different microservices need to agree on:

- The API
- The data format
- The error pattern
- Load balancing
- Many other

### REST

HTTP+JSON

> - Text protocol: Easy to understand;
> - Web infrastructure already built on top of HTTP;
> - Great tooling for testing, inspection, modification;
> - Loose coupling between c/s makes changes easy;
> - High-quality http implementation in every language;

- No formal API contract
  - Writing client libraries requires humans

### GRPC

gRPC which is short for Google RPC is an application based communication based on protocol buffers. These buffers can communicate language-anonymous (so ruby **to** python or C++ **to** Java for example).

**The messages & services are defined using <u>Protocol Buffers</u>.**

- After the definition, the rest of the gRPC code will be generated by the gPRC compiler and we just need to provide an implementation.

> One `.proto` for over 12 languages.

## Code

> [Setup For Your Project](https://chromium.googlesource.com/external/github.com/grpc/grpc/+/HEAD/src/cpp/README.md)

### CMAKE

If we just use the libraries offered by our system. 

```cmake
find_package(gRPC CONFIG REQUIRED)
add_executable(${PROJECT_NAME} my_exe.cc)
target_link_libraries(${PROJECT_NAME} gRPC::grpc++)

// For Mac OSX user, you may need to use pkgconfig
find_package(PkgConfig REQUIRED)
pkg_search_module(GRPC REQUIRED grpc)
pkg_search_module(GRPCPP REQUIRED grpc++>=1.22.0)
```

If we want to use gRPC as part of the project:

```cmake
include(FetchContent) # CMAKEv3.11+
FetchContent_Declare(
  gRPC
  GIT_REPOSITORY https://github.com/grpc/grpc
  GIT_TAG        v1.25.0
)
FetchContent_MakeAvailable(gRPC)

add_executable(${PROJECT_NAME} my_exe.cc)
target_link_libraries(${PROJECT_NAME} grpc++)
```

### C++

> https://grpc.io/docs/tutorials/basic/cpp/

Use `grpcpp` instead of `grpc++`(deprecated).

General steps:

- Define a service in a .proto file.
- Generate server and client code using the protocol buffer compiler.
- Use the C++ gRPC API to write a simple client and server for your service.

